<div class="animated fadeIn cms-main">
  <div class="card cms-content">
    <div class="titleCat">
      <h1 class="cms-heading-inline">Danh sách chức năng</h1>
      <button class="cms-addnew" type="button" (click)="OpenModalFunction(undefined)"><i class="fa fa-plus"></i>&nbsp;Thêm mới</button>
    </div>
    <div class="description-page">
      <!--<blockquote class="{{isNoitify ? 'hidden' : ''}}">
        <p>Khu vực hiển thị danh sách các chức năng của website, quản lý ẩn hiện menu, khu vực đã được phát triển sẵn, hãy biết rõ mình đang làm gì tại khu vực này!</p>
        <a class="close" href="javascript:void(0)" (click)="closeNoityfy()"><span>×</span></a>
      </blockquote>-->
    </div>
    <div class="card-body">
      <div id="DataTables_Table_0_wrapper" class="dataTables_wrapper dt-bootstrap4 no-footer">
        <div class="row cms-filter">
          <div class="col-sm-12 col-md-6" style="padding-left:0px; margin-left: -5px;display: flex;">
            <ul class="cms-subsubsub">
              <li class="all"><a class="current" aria-current="page">Tất cả <span class="count">({{ paging.item_count }})</span></a> | </li>
              <li class="publish"><a>Hiển thị <span class="count">({{ paging.item_count }})</span></a></li>
            </ul>
          </div>
          <div class="col-sm-12 col-md-6" style="display: flex; justify-content: flex-end;align-items: flex-end; padding-right:0">
            <div class="dataTables_length" id="DataTables_Table_0_length">
              <label>
                Xem&nbsp;
                <select name="DataTables_Table_0_length" aria-controls="DataTables_Table_0" class="custom-select custom-select-sm form-control form-control-sm" [(ngModel)]="paging.page_size" (change)="GetListFunction()">
                  <option value="10">10</option>
                  <option value="25">25</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                </select>&nbsp;bản ghi
              </label>
            </div>
          </div>
        </div>
        <div class="row cms-filter action-table">
          <div class="col-sm-12 col-md-3">
            <!--<ng-select class="mw150-select"
                       [items]="ActionTable"
                       bindLabel="Name"
                       bindValue="Id"
                       [clearable]="true"
                       placeholder="Tác vụ"
                       [(ngModel)]="ActionId"
                       [ngModelOptions]="{standalone: true}">
            </ng-select>
            <button class="cms-addnew button-action" type="button" [disabled]="!ActionId" (click)="ActionTableFunc()"><i class="fa-solid fa-badge-check"></i> Áp dụng</button>-->
          </div>
          <div class="col-sm-12 col-md-9" style="text-align: right; display: flex; justify-content: end;">
            <input type="text" class="form-control form-control-sm" placeholder="Nhập tên cần tìm...." aria-controls="DataTables_Table_0" style="margin-right:10px;" [(ngModel)]="q.txtSearch" (keyup.enter)="QueryChanged()">
            <input type="text" class="form-control form-control-sm" placeholder="Nhập mã cần tìm...." aria-controls="DataTables_Table_0" style="margin-right:10px;" [(ngModel)]="q.txtCode" (keyup.enter)="QueryChanged()">
            <input type="text" class="form-control form-control-sm" placeholder="Nhập đường dẫn cần tìm...." aria-controls="DataTables_Table_0" [(ngModel)]="q.txtSlug" (keyup.enter)="QueryChanged()">
          </div>
        </div>
        <div class="row content-table-data">
          <div class="col-sm-12">
            <table class="table list-cat table-striped table-bordered datatable dataTable no-footer" id="DataTables_Table_0" role="grid" aria-describedby="DataTables_Table_0_info" style="border-collapse: collapse !important">
              <thead>
                <tr role="row">
                  <!--<th class="btn-action-table" style="width: 5%;">
                    <div class="squaredcheck">
                      <input type="checkbox" class="checkbox1" id="CheckAll" name="CheckAll" [value]="true" (change)="CheckActionTable(undefined)" [(ngModel)]="CheckAll">
                      <label for="CheckAll"><span></span></label>
                    </div>
                  </th>-->
                  <th style="width: 25%"><span [ngClass]="GetClassSortTable('Name')" (click)="SortTable('Name')" class="sortBy">Tên</span></th>
                  <th style="width: 15%;"><span [ngClass]="GetClassSortTable('Code')" (click)="SortTable('Code')" class="sortBy">Mã</span></th>
                  <th style="width: 20%;"><span [ngClass]="GetClassSortTable('Url')" (click)="SortTable('Url')" class="sortBy">Đường dẫn</span></th>
                  <th style="width: 10%;" class="text-center"><span [ngClass]="GetClassSortTable('Location')" (click)="SortTable('Location')" class="sortBy">Vị trí</span></th>
                  <th style="width: 25%">Chức năng cha</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of listFunction; let i = index" role="row" ng-class-odd='odd' ng-class-even='even'>
                  <!--<td class="btn-action-table" style="padding: 0.75rem!important;">
                    <div class="squaredcheck">
                      <input type="checkbox" class="checkbox1" id="Check{{item.FunctionId}}" name="Check{{item.FunctionId}}" [value]="true" [(ngModel)]="item.Action" (change)="CheckActionTable(item.FunctionId)">
                      <label for="Check{{item.FunctionId}}"><span></span></label>
                    </div>
                  </td>-->
                  <td class="sorting_1 name-child column-name">
                    {{ item.Name }}
                    <ul class="cms-function">
                      <li class="id-item">ID: {{item.FunctionId}} | </li>
                      <li (click)="OpenModalFunction(item)">Chỉnh sửa | </li>
                      <li (click)="ShowConfirmDelete(item.FunctionId)" class="detete-item">Xóa</li>
                    </ul>
                  </td>
                  <td>{{ item.Code }}</td>
                  <td>
                    {{ item.Url }}
                  </td>
                  <td class="text-center">{{item.Location}}</td>
                  <td>{{item.functionParent != null ? item.functionParent.Name : ""}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="row  cms-paging">
          <div class="col-sm-12 col-md-5">
            <div *ngIf="paging.item_count > 0" class="dataTables_info" id="DataTables_Table_0_info" role="status" aria-live="polite">
              Hiển thị <span>{{ (paging.page - 1) * paging.page_size + 1 }}</span> <i class="fa fa-long-arrow-right"></i>  <span>{{ paging.item_count < paging.page * paging.page_size ? paging.item_count : paging.page * paging.page_size }}</span>&nbsp;<i class="fa fa-ellipsis-v"></i>&nbsp;<span>{{ paging.item_count }}</span> bản ghi
            </div>
          </div>
          <div class="col-xs-12 col-md-7">
            <pagination [totalItems]="paging.item_count" [(ngModel)]="paging.page" [maxSize]="5" [itemsPerPage]="paging.page_size" class="pagination-sm pull-right"
                        previousText='<i class="fa-solid fa-chevron-left"></i>' nextText='<i class="fa-solid fa-chevron-right"></i>' [boundaryLinks]="true" (pageChanged)="PageChanged($event)"></pagination>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div [config]="{backdrop: 'static',  keyboard: false}" bsModal #modalFunction="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" [config]="{backdrop: 'static',  keyboard: false}">
  <div class="modal-dialog modal-lg" role="document">
    <form class="login-form">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" *ngIf="Item.FunctionId==undefined">Thêm mới chức năng</h4>
          <h4 class="modal-title" *ngIf="Item.FunctionId!=undefined">Cập nhật chức năng</h4>
          <button type="button" class="close" (click)="modalFunction.hide()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="card" style="border: none; padding: 1.5rem; margin-bottom: unset;">
            <div class="card-body body-form-add-new">
              <div class="col-sm-12 col-md-12">
                <div class="form-group row">
                  <label class="col-md-4 col-form-label" for="Code">Mã chức năng<span *ngIf="Item.Code==undefined || Item.Code==''" style="color: red;">&ngsp;(*)</span></label>
                  <div class="col-md-8">
                    <input type="text" id="Code" name="Code" class="form-control" placeholder="" [(ngModel)]="Item.Code" autocomplete="off">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label" for="Name">Tên chức năng<span *ngIf="Item.Name==undefined || Item.Name==''" style="color: red;">&ngsp;(*)</span></label>
                  <div class="col-md-8">
                    <input type="text" id="Name" name="Name" class="form-control" placeholder="" [(ngModel)]="Item.Name" autocomplete="off">
                  </div>
                </div>

                <div class="form-group row">
                  <label class="col-md-4 col-form-label" for="">Chức năng cha</label>
                  <div class="col-md-8">
                    <ng-select [items]="listFunctionParent"
                      bindLabel="Name"
                      bindValue="FunctionId"
                      placeholder="Chọn danh mục cha"
                      [(ngModel)]="Item.FunctionParentId"
                      [ngModelOptions]="{standalone: true}">
                      <ng-template ng-label-tmp let-item="item">
                        <span>{{item.Name}}</span>
                      </ng-template>
                      <ng-template ng-option-tmp let-item="item" let-index="index">
                        <span [innerHTML]="item.Space"></span><span>{{item.Name}}</span>
                      </ng-template>
                    </ng-select>
                  </div>
                </div>

                <div class="form-group row">
                  <label class="col-md-4 col-form-label" for="Url">Đường dẫn<span *ngIf="Item.Url==undefined || Item.Url==''" style="color: red;">&ngsp;(*)</span></label>
                  <div class="col-md-8">
                    <input type="text" id="Url" name="Url" class="form-control" placeholder="" [(ngModel)]="Item.Url" autocomplete="off">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label" for="Location">Vị trí</label>
                  <div class="col-md-8">
                    <input type="number" id="Location" name="Location" class="form-control" min="1" onkeypress="return event.charCode >= 48" placeholder="" [(ngModel)]="Item.Location" min="0" onkeypress="return event.charCode >= 48" autocomplete="off">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label" for="Icon">Icon</label>
                  <div class="col-md-8">
                    <input type="text" id="Icon" name="Icon" class="form-control" placeholder="" [(ngModel)]="Item.Icon">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label" for="Note">Chú thích</label>
                  <div class="col-md-8">
                    <textarea id="Note" name="Note" rows="3" class="form-control" placeholder="" [(ngModel)]="Item.Note"></textarea>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" appNoDblClickMat (click)="SaveFunc()">Lưu thông tin</button>
          <button type="button" class="btn btn-danger" (click)="modalFunction.hide()">Đóng</button>
        </div>
      </div>
    </form>
  </div>
</div>
