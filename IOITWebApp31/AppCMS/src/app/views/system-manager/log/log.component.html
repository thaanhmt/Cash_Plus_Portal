<div class="animated fadeIn cms-main">
  <div class="card cms-content">
    <div class="titleCat">
      <h1 class="cms-heading-inline">Nhật ký hệ thống</h1>
    </div>
    <div class="description-page">
      <blockquote class="{{isNoitify ? 'hidden' : ''}}">
        <p>Khu vực hiển thị danh sách tất cả các hoạt động và ghi lại nhật ký thay đổi trên hệ thống! </p>
        <a class="close" href="javascript:void(0)" (click)="closeNoityfy()"><span>×</span></a>
      </blockquote>
    </div>
    <div class="card-body">
      <div id="DataTables_Table_0_wrapper" class="dataTables_wrapper dt-bootstrap4 no-footer">
        <div class="row cms-filter">
          <div class="col-sm-12 col-md-6" style="padding-left:0px; margin-left: -5px;    display: flex;">
            <!--<ul class="cms-subsubsub">
              <li class="all"><a href="javascript:void(0)" class="{{activeU ? 'current' : ''}}" (click)="QueryChanged()" aria-current="page">
                <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="globe-asia" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="svg-inline--fa fa-globe-asia fa-w-16"><path fill="currentColor" d="M248 8C111.03 8 0 119.03 0 256s111.03 248 248 248 248-111.03 248-248S384.97 8 248 8zm-11.34 240.23c-2.89 4.82-8.1 7.77-13.72 7.77h-.31c-4.24 0-8.31 1.69-11.31 4.69l-5.66 5.66c-3.12 3.12-3.12 8.19 0 11.31l5.66 5.66c3 3 4.69 7.07 4.69 11.31V304c0 8.84-7.16 16-16 16h-6.11c-6.06 0-11.6-3.42-14.31-8.85l-22.62-45.23c-2.44-4.88-8.95-5.94-12.81-2.08l-19.47 19.46c-3 3-7.07 4.69-11.31 4.69H50.81C49.12 277.55 48 266.92 48 256c0-110.28 89.72-200 200-200 21.51 0 42.2 3.51 61.63 9.82l-50.16 38.53c-5.11 3.41-4.63 11.06.86 13.81l10.83 5.41c5.42 2.71 8.84 8.25 8.84 14.31V216c0 4.42-3.58 8-8 8h-3.06c-3.03 0-5.8-1.71-7.15-4.42-1.56-3.12-5.96-3.29-7.76-.3l-17.37 28.95zM408 358.43c0 4.24-1.69 8.31-4.69 11.31l-9.57 9.57c-3 3-7.07 4.69-11.31 4.69h-15.16c-4.24 0-8.31-1.69-11.31-4.69l-13.01-13.01a26.767 26.767 0 0 0-25.42-7.04l-21.27 5.32c-1.27.32-2.57.48-3.88.48h-10.34c-4.24 0-8.31-1.69-11.31-4.69l-11.91-11.91a8.008 8.008 0 0 1-2.34-5.66v-10.2c0-3.27 1.99-6.21 5.03-7.43l39.34-15.74c1.98-.79 3.86-1.82 5.59-3.05l23.71-16.89a7.978 7.978 0 0 1 4.64-1.48h12.09c3.23 0 6.15 1.94 7.39 4.93l5.35 12.85a4 4 0 0 0 3.69 2.46h3.8c1.78 0 3.35-1.18 3.84-2.88l4.2-14.47c.5-1.71 2.06-2.88 3.84-2.88h6.06c2.21 0 4 1.79 4 4v12.93c0 2.12.84 4.16 2.34 5.66l11.91 11.91c3 3 4.69 7.07 4.69 11.31v24.6z" class=""></path></svg>Tất cả <span class="count" *ngIf="activeU == true">({{ paging.item_count }})</span></a></li>             
            </ul>-->
          </div>
          <div class="col-sm-12 col-md-6" style="display: flex; justify-content: flex-end;align-items: flex-end; padding-right:0">
            <label style="margin-right:10px;display: flex;align-items: center;">
              <span class="search-box">Tìm kiếm</span>
              <input type="text" class="form-control form-control-sm" placeholder="Nhập từ khóa cần tìm...." aria-controls="DataTables_Table_0" [(ngModel)]="q.txtSearch" (keyup.enter)="QueryChanged()">
            </label>
            <div class="dataTables_length" id="DataTables_Table_0_length">
              <label>
                Xem&nbsp;
                <select name="DataTables_Table_0_length" aria-controls="DataTables_Table_0" class="custom-select custom-select-sm form-control form-control-sm" [(ngModel)]="paging.page_size" (change)="GetListPublication()">
                  <option value="10">10</option>
                  <option value="25">25</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                </select>&nbsp;bản ghi
              </label>
            </div>
          </div>
        </div>
        <div class="row cms-filter action-table">
          <div class="col-sm-6 col-md-3" style="padding:0">
            <ng-select *ngIf="RoleCode == 'ADMIN' || RoleCode == 'TKTC'" class="mw150-select"
                       [items]="ActionTable"
                       bindLabel="Name"
                       bindValue="Id"
                       [clearable]="true"
                       placeholder="Tác vụ"
                       [(ngModel)]="ActionId"
                       [ngModelOptions]="{standalone: true}">
            </ng-select>
            <button *ngIf="RoleCode == 'ADMIN' || RoleCode == 'TKTC'" class="cms-addnew button-action" type="button" [disabled]="!ActionId" (click)="ActionTableFunc()">&nbsp;Áp dụng</button>
          </div>
          <div class="col-sm-12 col-md-9" style="text-align:right; padding-right:0">
            <ng-select [items]="listAuthor"
                       class="mw150-select"
                       bindLabel="FullName"
                       bindValue="UserId"
                       [multiple]="false"
                       placeholder="Người dùng"
                       (change)="QueryChanged()"
                       [(ngModel)]="q.UserId"
                       [ngModelOptions]="{standalone: true}"
                       style="text-align:left;">
            </ng-select>
          </div>
        </div>
        <div class="row content-table-data">
          <div class="col-sm-12">
            <table class="table table-striped table-bordered datatable dataTable no-footer list-cat " id="DataTables_Table_0" role="grid" aria-describedby="DataTables_Table_0_info">
              <thead>
                <tr role="row">
                  <th *ngIf="RoleCode == 'ADMIN' || RoleCode == 'TKTC'" class="btn-action-table" style="width:15px;">
                    <div class="squaredcheck">
                      <input type="checkbox" class="checkbox1" id="CheckAll" name="CheckAll" [value]="true" (change)="CheckActionTable(undefined)" [(ngModel)]="CheckAll">
                      <label for="CheckAll"><span></span></label>
                    </div>
                  </th>
                  <th class="text-center" *ngIf="RoleCode != 'ADMIN' && RoleCode != 'TKTC'" style="width:5%;">
                    STT
                  </th>
                  <th class="column-name">
                    <span class="sortBy" [ngClass]="GetClassSortTable('Title')" (click)="SortTable('Title')">Tên Log</span>
                  </th>
                  <!--<th class="column-thumb text-center">Đối tượng</th>-->
                  <!--<th style="width:180px;">Danh mục</th>-->
                  <th class="text-center" style="width:45px;">
                    <span>Loại Log</span>
                  </th>
                  <th class="text-center" style="width:40px;">
                    Ngày tạo
                  </th>
                  <!--<th class="text-center" *ngIf="listLanguage.length > 1">Ngôn ngữ</th>-->
                  <th class="text-center" style="width:100px;">
                    Người thay đổi
                  </th>
                  <th class="text-center" style="width:65px;">
                    <span>Địa chỉ IP</span>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of listLog; let i = index" role="row" ng-class-odd='odd' ng-class-even='even'>
                  <td *ngIf="RoleCode == 'ADMIN' || RoleCode == 'TKTC'" class="btn-action-table" style="padding: 0.75rem!important;">
                    <div class="squaredcheck">
                      <input type="checkbox" class="checkbox1" id="Check{{item.ActionId}}" name="Check{{item.ActionId}}" [value]="true" [(ngModel)]="item.Action" (change)="CheckActionTable(item.ActionId)">
                      <label for="Check{{item.ActionId}}"><span></span></label>
                    </div>
                  </td>
                  <td class="text-center" *ngIf="RoleCode != 'ADMIN' && RoleCode != 'TKTC'" style="width:5%;">
                    {{i+1}}
                  </td>
                  <td class="column-name name-child">
                    {{item.ActionName}}
                    <ul class="cms-function">
                      <li class="id-item">ID: {{item.ActionId}} | </li>
                      <li *ngIf="CheckRole.View">
                        <a href="javascrip:void(0);" (click)="OpenNewsModal(item, 0)">Xem chi tiết |</a>
                      </li>
                      <li *ngIf="CheckRole.Delete" (click)="ShowConfirmDelete(item.ActionId)" class="detete-item">Xóa</li>
                    </ul>
                  </td>
                  <!--<td class="text-center column-hs">
                    {{ item.TargetName }}
                  </td>-->
                  <td class="text-center column-hs" *ngIf="item.ActionType == 1">
                    <span class="badge badge-success">Tạo mới</span>
                  </td>
                  <td class="text-center column-hs" *ngIf="item.ActionType == 2">
                    <span class="badge badge-primary">Cập nhật</span>
                  </td>
                  <td class="text-center column-hs" *ngIf="item.ActionType == 3">
                    <span class="badge badge-danger">Xoá</span>
                  </td>
                  <td class="text-center column-hs" *ngIf="item.ActionType == 9">
                    <span class="badge badge-info">Đăng nhập</span>
                  </td>
                  <td class="text-center column-hs">
                    {{item.CreatedAt | date: 'dd/MM/yyyy HH:mm:ss'}}
                  </td>
                  <td class="text-center column-hs">
                    {{ item.AuthorName }}
                  </td>
                  <td class="text-center column-hs">
                    {{item.Ipaddress}}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="row cms-paging">
          <div class="col-sm-12 col-md-5">
            <div *ngIf="paging.item_count > 0" class="dataTables_info" id="DataTables_Table_0_info" role="status" aria-live="polite">
              Hiển thị <span>{{ (paging.page - 1) * paging.page_size + 1 }}</span> <i class="fa fa-long-arrow-right"></i>  <span>{{ paging.item_count < paging.page * paging.page_size ? paging.item_count : paging.page * paging.page_size }}</span>&nbsp;<i class="fa fa-ellipsis-v"></i>&nbsp;<span>{{ paging.item_count }}</span> bản ghi
            </div>
          </div>
          <div class="col-xs-12 col-md-7">
            <pagination [totalItems]="paging.item_count" [(ngModel)]="paging.page" [maxSize]="5" [itemsPerPage]="paging.page_size" class="pagination-sm pull-right"
                        previousText="&lsaquo;" nextText="&rsaquo;" [boundaryLinks]="true" (pageChanged)="PageChanged($event)"></pagination>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div [config]="{backdrop: 'static',  keyboard: false}" bsModal #NewsModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-big" role="document" style="max-width:800px">
    <div class="login-form">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" *ngIf="Item.ActionId!=undefined">Xem chi tiết</h4>
          <button type="button" class="close" (click)="NewsModal.hide()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="card-body body-form-add-new">
            <div class="row">
              <div class="col-sm-12 col-md-12">
                <div class="col-sm-12 col-md-12">
                  <div class="form-group row">
                    <label class="col-md-12 col-form-label" for="Title">Tên Log</label>
                    <div class="col-md-12">
                      <input type="text" id="Title" name="Title" maxlength="1000" class="form-control" placeholder=""
                             [(ngModel)]="Item.ActionName" autocomplete="off" disabled>
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-12 col-form-label">Loại</label>
                    <div class="col-md-12" *ngIf="Item.ActionType == 1">
                      <input type="text" class="form-control" placeholder="" value="Tạo mới" autocomplete="off"
                             disabled>
                    </div>
                    <div class="col-md-12" *ngIf="Item.ActionType == 2">
                      <input type="text" class="form-control" placeholder="" value="Cập nhật" autocomplete="off"
                             disabled>
                    </div>
                    <div class="col-md-12" *ngIf="Item.ActionType == 3">
                      <input type="text" class="form-control" placeholder="" value="Xoá" autocomplete="off" disabled>
                    </div>
                    <div class="col-md-12" *ngIf="Item.ActionType == 9">
                      <input type="text" class="form-control" placeholder="" value="Đăng nhập" autocomplete="off"
                             disabled>
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-12 col-form-label">ID Đối tượng</label>
                    <div class="col-md-12">
                      <input type="text" class="form-control" placeholder="" [(ngModel)]="Item.TargetId"
                             autocomplete="off" disabled>
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-12 col-form-label">Đối tượng</label>
                    <div class="col-md-12">
                      <input type="text" class="form-control" placeholder="" [(ngModel)]="Item.TargetName"
                             autocomplete="off" disabled>
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-12 col-form-label">Chi tiết nhật ký</label>
                    <div class="col-md-12">
                      <code>{{Item.Logs}}</code>
                    </div>
                  </div>
                  <!--<div class="form-group row">
                    <label class="col-md-12 col-form-label">Chi tiết trước thay đổi</label>
                    <div class="col-md-12">
                      <code>{{Item.LastLogs}}</code>
                    </div>
                  </div>-->
                  <div class="form-group row">
                    <label class="col-md-12 col-form-label">Ngày tạo</label>
                    <div class="col-md-12">
                      <div>{{Item.CreatedAt | date: 'dd/MM/yyyy'}}</div>
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-12 col-form-label">Địa chỉ Ip</label>
                    <div class="col-md-12">
                      <input type="text" class="form-control" placeholder="" [(ngModel)]="Item.Ipaddress"
                             autocomplete="off" disabled>
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-12 col-form-label">Người thay đổi</label>
                    <div class="col-md-12">
                      <input type="text" class="form-control" placeholder="" [(ngModel)]="Item.AuthorName"
                             autocomplete="off" disabled>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

